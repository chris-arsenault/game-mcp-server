# Knowledge Graph Tooling (2025-02-13)

## Summary
- Added `explore_graph_entity` (Neo4j neighborhood fetch) and `search_graph_semantic` (Qdrant vector search) to MCP tool catalog.
- Introduced `Neo4jService` for Bolt access and shared `code_graph` collection (768d embeddings) generated by the graph-builder pipeline.
- Graph builder now runs as a long-lived REST service (`POST /build`, `POST /reset`, `GET /status`) instead of a one-shot CLI, accepts per-request `repoUrl`/`branch` overrides, and returns immediately after queuing builds (poll `/status` for progress).
- LLM enrichment now uses OpenAI (`OPENAI_API_KEY`, optional `OPENAI_MODEL`/`OPENAI_TEMPERATURE`) instead of Anthropic.
- New environment variables: `NEO4J_URL`, `NEO4J_USER`, `NEO4J_PASSWORD`, `GRAPH_COLLECTION`, and `GRAPH_BUILDER_PORT` (`4100` default).

## Agent Integration Notes
- Prerequisite: ensure the graph builder has cloned `chris-arsenault/genai-game-engine`, populated Neo4j, and synced embeddings to Qdrant (`code_graph` collection). The builder container now exposes port `4100` with JSON endpoints; trigger jobs via `POST /build` (body: `{"mode":"full|incremental","stage":"all|parse|enrich|populate","baseCommit": "..."}`) and poll with `GET /status`.
- `search_graph_semantic`:
  - Inputs: `query` (required), optional `limit` (1-20), `type` filter (`file`, `class`, `function`, etc.), and `minScore` (default 0.55).
  - Output: `matches[]` with `entityId`, `type`, `path`, `semanticDescription`, `architecturalRole`, and similarity `score`.
  - Suggested use: rapid discovery of relevant modules prior to auth/Neo4j traversal.
- `explore_graph_entity`:
  - Inputs: `entityId` (e.g., `file:src/server.ts`), optional `maxNeighbors` (1-100, default 25).
  - Output: `{ entity, relationships[] }`, where `relationships` include `direction` (`inbound`/`outbound`), `type`, and a condensed neighbor node payload.
  - Use as a structural probe prior to edits; feed results into planning prompts or visualization utilities.
- Error handling: both tools forward Neo4j/Qdrant connection errors directly. Agents should check for `found: false` on `explore_graph_entity` and fallback to a repo scan when entities are missing.
- Combined workflow recommendation:
  1. Call `search_graph_semantic` with the natural-language task (e.g., “event bus subscription handling”).
  2. Select the top hit `entityId` and invoke `explore_graph_entity` to obtain neighboring classes/functions.
  3. Use returned metadata (`semanticDescription`, `purpose`, `architecturalRole`) to craft targeted refactor or documentation updates.
- To reset the staging cache or clear incremental markers, call `POST /reset` on the graph-builder API before kicking off a full rebuild; the REST layer is the sole integration surface (no local helper scripts).
